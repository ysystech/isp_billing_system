{% extends "web/app/app_base.html" %}
{% load static %}
{% load role_tags %}
{% block app %}
<section class="app-card">
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
    <h1 class="pg-title mb-4 sm:mb-0">Customers</h1>
    {% if user|has_permission:"customers.create_customer" %}
    <a href="{% url 'customers:customer_create' %}" class="btn btn-primary">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
      </svg>
      Add New Customer
    </a>
    {% endif %}
  </div>

  <!-- Search and Filter Form -->
  <form method="get" class="mb-6">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="md:col-span-2">
        {{ form.search }}
      </div>
      <div>
        {{ form.status }}
      </div>
    </div>
    <span id="search-indicator" class="htmx-indicator">
      <div class="flex items-center mt-2">
        <span class="loading loading-spinner loading-sm mr-2"></span>
        Searching...
      </div>
    </span>
  </form>

  <!-- Customer Table -->
  <div id="customer-list">
    {% include 'customers/partials/customer_table.html' %}
  </div>
</section>

<!-- Alpine.js for confirmations -->
<script>
  document.addEventListener('alpine:init', () => {
    Alpine.data('customerActions', () => ({
      confirmDelete(customerId, customerName) {
        if (confirm(`Are you sure you want to deactivate ${customerName}?`)) {
          htmx.ajax('POST', `/customers/${customerId}/delete/`, {
            target: `#customer-${customerId}`,
            swap: 'outerHTML'
          });
        }
      }
    }));
  });
</script>
{% endblock %}
