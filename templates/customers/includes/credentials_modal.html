{% if new_credentials %}
<!-- New Customer Credentials Modal -->
<dialog id="credentials_modal" class="modal modal-open">
  <div class="modal-box max-w-2xl">
    <h3 class="font-bold text-lg mb-4">Customer Portal Account Created!</h3>
    
    <div class="alert alert-warning mb-4">
      <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
      </svg>
      <span>Please save these credentials securely. They will not be shown again!</span>
    </div>
    
    <div class="bg-base-200 p-6 rounded-lg space-y-4">
      <div>
        <p class="text-sm text-base-content/70">Portal URL</p>
        <p class="font-mono text-lg bg-base-100 p-2 rounded">{{ request.get_host }}/portal/</p>
      </div>
      
      <div>
        <p class="text-sm text-base-content/70">Username</p>
        <div class="flex items-center gap-2">
          <p class="font-mono text-lg bg-base-100 p-2 rounded flex-1" id="username-display">{{ new_credentials.username }}</p>
          <button class="btn btn-sm btn-ghost" onclick="copyToClipboard('username-display')" title="Copy username">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
            </svg>
          </button>
        </div>
      </div>
      
      <div>
        <p class="text-sm text-base-content/70">Password</p>
        <div class="flex items-center gap-2">
          <p class="font-mono text-lg bg-base-100 p-2 rounded flex-1" id="password-display">{{ new_credentials.password }}</p>
          <button class="btn btn-sm btn-ghost" onclick="copyToClipboard('password-display')" title="Copy password">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
            </svg>
          </button>
        </div>
      </div>
    </div>
    
    <div class="modal-action">
      <button class="btn btn-primary" onclick="printWelcomeSheet()">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
        </svg>
        Print Welcome Sheet
      </button>
      <button class="btn" onclick="credentials_modal.close()">Close</button>
    </div>
  </div>
  <form method="dialog" class="modal-backdrop">
    <button>close</button>
  </form>
</dialog>

<script>
function copyToClipboard(elementId) {
  const element = document.getElementById(elementId);
  const text = element.textContent;
  navigator.clipboard.writeText(text).then(() => {
    // Show toast or feedback
    const btn = event.currentTarget;
    const originalHtml = btn.innerHTML;
    btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-success" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>';
    setTimeout(() => {
      btn.innerHTML = originalHtml;
    }, 1000);
  });
}

function printWelcomeSheet() {
  // Set credentials in print sheet
  document.getElementById('print-username').textContent = '{{ new_credentials.username }}';
  document.getElementById('print-password').textContent = '{{ new_credentials.password }}';
  
  // Close modal
  credentials_modal.close();
  
  // Print
  setTimeout(() => {
    window.print();
  }, 100);
}
</script>
{% endif %}
