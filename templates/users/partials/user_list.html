{% load role_tags %}

<!-- Debug info - remove in production -->
<div class="text-xs text-gray-500 mb-4">
  <p>Current user ID: {{ request.user.id }}</p>
  <p>Current user email: {{ request.user.email }}</p>
  <p>Has delete permission: {% if request.user|has_permission:"users.delete_customuser" %}Yes{% else %}No{% endif %}</p>
</div>
{% if users %}
<div class="overflow-x-auto">
  <table class="table table-zebra">
    <thead>
      <tr>
        <th>Full Name</th>
        <th>Email</th>
        <th>Status</th>
        <th>Joined</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for user_item in users %}
      <tr id="user-{{ user_item.id }}">
        <td>
          <div class="font-medium">{{ user_item.get_full_name|default:"No name" }}</div>
        </td>
        <td>
          <div class="text-sm">{{ user_item.email }}</div>
        </td>
        <td>
          {% if user_item.is_active %}
          <span class="badge badge-success">Active</span>
          {% else %}
          <span class="badge badge-ghost">Inactive</span>
          {% endif %}
        </td>
        <td>
          <div class="text-sm">{{ user_item.date_joined|date:"M d, Y" }}</div>
        </td>
        <td>
          <div class="flex space-x-2" x-data="userActions">
            <a href="{% url 'users:user_management_detail' user_item.id %}" 
               class="btn btn-ghost btn-xs">
              View
            </a>
            {% if request.user|has_permission:"users.change_customuser" and user_item.id != request.user.id %}
            <a href="{% url 'users:user_management_update' user_item.id %}" 
              class="btn btn-ghost btn-xs"
              title="Edit">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
              </svg>
            </a>
            {% endif %}
            {% if user_item.is_active and request.user|has_permission:"users.delete_customuser" and user_item.id != request.user.id %}
            <button class="btn btn-ghost btn-xs text-error"
                    @click="confirmDelete({{ user_item.id }}, '{{ user_item.get_full_name|escapejs }}')">
              Delete User
            </button>
            {% endif %}
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% else %}
<div class="text-center py-12">
  <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
  </svg>
  <p class="text-gray-500 mb-4">No users found.</p>
  {% if user|has_permission:"users.add_customuser" %}
  <a href="{% url 'users:user_management_create' %}" class="btn btn-primary btn-sm">
    Create First User
  </a>
  {% endif %}
</div>
{% endif %}
